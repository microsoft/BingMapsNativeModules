variables:
  sdk: 'iphoneos'
  configuration: 'Build'
  msMapsModulesPath: 'iOS/MSMapsModules'
  msMapsModulesToRootPath: '../../'
  msMapsModulesWorkspacePath: '$(msMapsModulesPath)/MSMapsModules.xcworkspace'
  
trigger:
- master

jobs:
- job: Build_Android
  pool:
    vmImage: 'windows-latest'
  steps:
    # Create dummy secrets.gradle
  - bash: |
      echo ext.credentialsKey = "\"DummyKey\"" > secrets.gradle
      echo `<secrets.gradle`
    displayName: Create secrets.gradle
    workingDirectory: 'Android/Samples/app'
  - task: Gradle@2
    inputs:
      workingDirectory: 'Android/Samples'
      gradleWrapperFile: 'Android/Samples/gradlew'
      gradleOptions: '-Xmx3072m'
      publishJUnitResults: false
      testResultsFiles: '**/TEST-*.xml'
      tasks: 'build'

- job: Build_iOS
  pool:
    vmImage: 'macOS-10.14'
  steps:
  - bash: |
      cd $(msMapsModulesPath)
      pod install
      cd $(msMapsModulesToRootPath)
    displayName: 'pod install'
  - task: Xcode@5
    inputs:
      sdk: '$(sdk)'
      xcWorkspacePath: '$(msMapsModulesWorkspacePath)'
      scheme: 'MSMapsModules'
      configuration: '$(configuration)'
      xcodeVersion: 'default'
      packageApp: false
  - task: Xcode@5
    inputs:
      sdk: '$(sdk)'
      xcWorkspacePath: '$(msMapsModulesWorkspacePath)'
      scheme: 'MSMapsModulesTestApp'
      configuration: '$(configuration)'
      xcodeVersion: 'default'
      packageApp: false